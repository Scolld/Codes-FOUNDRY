<!-- Partial pour un item de quête dans la vue arbre -->
<li class="quest-item {{status}}" 
    data-quest-id="{{id}}" 
    data-status="{{status}}"
    data-children-count="{{children.length}}"
    data-has-relations="{{#if (or blockedByIds.length blocksIds.length relatedIds.length)}}true{{/if}}"
    draggable="true">
  <div class="quest-header-row">
    <!-- Toggle pour déplier/replier -->
    {{#if hasChildren}}
      <button class="quest-toggle" title="{{#if isExpanded}}Replier{{else}}Déplier{{/if}}">
        <i class="fas {{#if isExpanded}}fa-chevron-down{{else}}fa-chevron-right{{/if}}"></i>
      </button>
    {{else}}
      <span class="quest-spacer"></span>
    {{/if}}
    
    <!-- Badge de statut -->
    <span class="status-badge" style="background-color: {{statusColor}}" title="{{statusLabel}}">
      <i class="fas {{statusIcon}}"></i>
    </span>
    
    <!-- Titre (cliquable pour voir les détails) -->
    <span class="quest-title">{{title}}</span>
    
    <!-- Indicateur de récompenses -->
    {{#if rewardItems.length}}
      <span class="reward-indicator" title="{{rewardItems.length}} récompense(s)">
        <i class="fas fa-gift"></i> {{rewardItems.length}}
      </span>
    {{/if}}
    
    <!-- Indicateur de complétion -->
    {{#if completedBy}}
      <span class="completed-indicator" title="Complétée par {{completedByName}}">
        <i class="fas fa-user-check"></i>
      </span>
    {{/if}}
    
    <!-- Actions -->
    <div class="quest-actions-inline">
      <!-- Bouton distribution rapide -->
      {{#if (and completedBy rewardItems.length (not rewardsDistributed))}}
        <button class="distribute-rewards-quick action-icon success" title="Distribuer les récompenses" data-quest-id="{{id}}">
          <i class="fas fa-hand-holding-heart"></i>
        </button>
      {{/if}}
      
      {{#if ../permissions.canChangeStatus}}
        <select class="quest-status-change" title="Changer le statut">
          <option value="connue" {{#if (eq status 'connue')}}selected{{/if}}>Connue</option>
          <option value="en_cours" {{#if (eq status 'en_cours')}}selected{{/if}}>En cours</option>
          <option value="terminee" {{#if (eq status 'terminee')}}selected{{/if}}>Terminée</option>
        </select>
      {{/if}}
      
      {{#if ../permissions.canAdd}}
        <button class="add-child-quest action-icon" title="Ajouter une sous-quête">
          <i class="fas fa-plus"></i>
        </button>
      {{/if}}
      
      {{#if ../permissions.canEdit}}
        <button class="quest-edit action-icon" title="Éditer">
          <i class="fas fa-edit"></i>
        </button>
      {{/if}}
      
      {{#if ../permissions.canDelete}}
        <button class="quest-delete action-icon" title="Supprimer">
          <i class="fas fa-trash"></i>
        </button>
      {{/if}}
    </div>
  </div>
  
  <!-- Sous-quêtes (si dépliées) -->
  {{#if (and hasChildren isExpanded)}}
    <ul class="quest-children">
      {{#each children}}
        {{> questItem this}}
      {{/each}}
    </ul>
  {{/if}}
</li>