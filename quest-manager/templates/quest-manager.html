<div class="quest-manager-container">
  <!-- En-tête avec stats et actions -->
  <header class="quest-header">
    <div class="quest-stats">
      <span class="stat active">
        <i class="fas fa-circle-dot"></i> En cours: {{stats.active}}
      </span>
      <span class="stat known">
        <i class="fas fa-circle"></i> Connues: {{stats.known}}
      </span>
      <span class="stat completed">
        <i class="fas fa-circle-check"></i> Terminées: {{stats.completed}}
      </span>
      <span class="stat total">
        <i class="fas fa-list"></i> Total: {{stats.total}}
      </span>
    </div>
    
    <div class="quest-actions">
      {{#if permissions.canAdd}}
        <button id="add-quest-btn" class="action-btn" title="Ajouter une quête">
          <i class="fas fa-plus"></i> Nouvelle quête
        </button>
      {{/if}}
      
      <button id="refresh-btn" class="action-btn" title="Rafraîchir">
        <i class="fas fa-sync"></i>
      </button>
      
      {{#if isGM}}
        <button id="permissions-btn" class="action-btn" title="Gérer les permissions">
          <i class="fas fa-user-lock"></i>
        </button>
        <button id="export-btn" class="action-btn" title="Exporter">
          <i class="fas fa-download"></i>
        </button>
        <button id="import-btn" class="action-btn" title="Importer">
          <i class="fas fa-upload"></i>
        </button>
      {{/if}}
    </div>
  </header>
  
  <!-- Barre de recherche et filtres -->
  <div class="quest-filters">
    <div class="search-box">
      <input type="text" id="quest-search" placeholder="Rechercher une quête..." value="{{searchQuery}}">
      {{#if searchQuery}}
        <button id="clear-search" class="clear-btn">
          <i class="fas fa-times"></i>
        </button>
      {{/if}}
    </div>
    
    <div class="filter-options">
      <label class="checkbox-label">
        <input type="checkbox" id="toggle-completed" {{#if showCompleted}}checked{{/if}}>
        Afficher les quêtes terminées
      </label>
    </div>
  </div>
  
  <!-- Onglets -->
  <nav class="tabs">
    <button class="tab-button {{#if (eq currentView 'tree')}}active{{/if}}" data-tab="tree">
      <i class="fas fa-sitemap"></i> Vue Arbre
    </button>
    <button class="tab-button {{#if (eq currentView 'graph')}}active{{/if}}" data-tab="graph">
      <i class="fas fa-project-diagram"></i> Vue Graphe
    </button>
  </nav>
  
  <!-- Contenu des onglets -->
  <div class="tab-content">
    <!-- Vue Arbre -->
    <div id="tree-view" class="tab-pane {{#if (eq currentView 'tree')}}active{{/if}}">
      <div class="quest-content">
        {{#if permissions.canView}}
          <!-- Quêtes En cours -->
          {{#if activeQuests.length}}
            <section class="quest-section active-section">
              <h2 class="section-title">
                <i class="fas fa-circle-dot"></i> Quêtes en cours
              </h2>
              <ul class="quest-list">
                {{#each activeQuests}}
                  {{> questItem this}}
                {{/each}}
              </ul>
            </section>
          {{/if}}
          
          <!-- Quêtes Connues -->
          {{#if knownQuests.length}}
            <section class="quest-section known-section">
              <h2 class="section-title">
                <i class="fas fa-circle"></i> Quêtes connues
              </h2>
              <ul class="quest-list">
                {{#each knownQuests}}
                  {{> questItem this}}
                {{/each}}
              </ul>
            </section>
          {{/if}}
          
          <!-- Quêtes Terminées -->
          {{#if showCompleted}}
            {{#if completedQuests.length}}
              <section class="quest-section completed-section">
                <h2 class="section-title">
                  <i class="fas fa-circle-check"></i> Quêtes terminées
                </h2>
                <ul class="quest-list">
                  {{#each completedQuests}}
                    {{> questItem this}}
                  {{/each}}
                </ul>
              </section>
            {{/if}}
          {{/if}}
          
          {{#unless (or activeQuests.length knownQuests.length completedQuests.length)}}
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <p>Aucune quête trouvée</p>
              {{#if ../permissions.canAdd}}
                <button id="add-quest-btn" class="action-btn">
                  <i class="fas fa-plus"></i> Créer votre première quête
                </button>
              {{/if}}
            </div>
          {{/unless}}
        {{else}}
          <div class="no-permission">
            <i class="fas fa-lock"></i>
            <p>Vous n'avez pas la permission de voir les quêtes</p>
          </div>
        {{/if}}
      </div>
    </div>
    
    <!-- Vue Graphe -->
    <div id="graph-view" class="tab-pane {{#if (eq currentView 'graph')}}active{{/if}}">
      <div id="graph-container"></div>
      <div class="graph-legend">
        <h3>Légende</h3>
        <ul>
          <li><span class="legend-color" style="background: #4a90e2;"></span> Connue</li>
          <li><span class="legend-color" style="background: #f5a623;"></span> En cours</li>
          <li><span class="legend-color" style="background: #7ed321;"></span> Terminée</li>
          <li><span class="legend-line solid"></span> Relation parent/enfant</li>
          <li><span class="legend-line dashed"></span> Bloque</li>
          <li><span class="legend-line dotted"></span> Lié à</li>
        </ul>
      </div>
    </div>
  </div>
</div>